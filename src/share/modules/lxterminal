#!/bin/bash

which lxterminal >/dev/null || return

: ${lxterminal_bg_color:=${terminal_bg_color}}
: ${lxterminal_fg_color:=${terminal_fg_color}}

LXTERMINAL_ENABLE_DEFAULT="true"
LXTERMINAL_CONFIG_FILE_DEFAULT="$HOME/config/lxterminal/lxterminal.conf"

LXTERMINAL_ENABLE="$(crudini      --get ${GCS_CONFIG_FILE} lxterminal enable      2>/dev/null || echo "${LXTERMINAL_ENABLE_DEFAULT}")"
LXTERMINAL_CONFIG_FILE="$(crudini --get ${GCS_CONFIG_FILE} lxterminal config_file 2>/dev/null || echo "${LXTERMINAL_CONFIG_FILE_DEFAULT}")"

if ! [ "${LXTERMINAL_ENABLE}" == "true" ]; then
    printf "* Ignoring LXTerminal (disabled from configuration).\n"

elif ! [ -f "${LXTERMINAL_CONFIG_FILE}" ]; then
    printf "* Ignoring LXTerminal (configuration file \"${LXTERMINAL_CONFIG_FILE}\" not found).\n"

elif [ "${GCS_ACTION}" == "create-backup" ]; then
    printf "* Making backup of LXTerminal configuration file..."

    LXTERMINAL_BACKUP_DIR="${GCS_BACKUPS_DIR}/${GCS_BACKUP_NAME}/lxterminal"
    mkdir -p "${LXTERMINAL_BACKUP_DIR}"
    cp "${LXTERMINAL_CONFIG_FILE}" "${LXTERMINAL_BACKUP_DIR}/lxterminal.conf"

    printf " done.\n"

elif [ "${GCS_ACTION}" == "restore-backup" ]; then
    printf "* Restoring backup of LXTerminal configuration file..."

    LXTERMINAL_BACKUP_DIR="${GCS_BACKUPS_DIR}/${GCS_BACKUP_NAME}/lxterminal"
    [ -f "${LXTERMINAL_BACKUP_DIR}/lxterminal.conf" ] && cp "${LXTERMINAL_BACKUP_DIR}/lxterminal.conf" "${LXTERMINAL_CONFIG_FILE}"

    printf " done.\n"

elif [ "${GCS_ACTION}" == "apply-theme" ]; then
    printf "* Setting colors for LXTerminal..."

    LXTERMINAL_TMP_DIR="${GCS_TMP_DIR}/lxterminal"
    LXTERMINAL_TMP_CONFIG_FILE="${LXTERMINAL_TMP_DIR}/lxterminal.conf"
    mkdir "${LXTERMINAL_TMP_DIR}"
    cp "${LXTERMINAL_CONFIG_FILE}" "${LXTERMINAL_TMP_CONFIG_FILE}"

    set_value "bgcolor" "=" "${lxterminal_bg_color}" "${LXTERMINAL_TMP_CONFIG_FILE}"
    set_value "fgcolor" "=" "${lxterminal_fg_color}" "${LXTERMINAL_TMP_CONFIG_FILE}"

    mv "${LXTERMINAL_TMP_CONFIG_FILE}" "${LXTERMINAL_CONFIG_FILE}"

    printf " done.\n"

fi

