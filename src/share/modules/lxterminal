#!/bin/bash

function init_module() {
    LXTERMINAL_ENABLE_DEFAULT="true"
    LXTERMINAL_CONFIG_FILE_DEFAULT="${HOME}/.config/lxterminal/lxterminal.conf"

    LXTERMINAL_ENABLE="$(crudini      --get ${GCS_CONFIG_FILE} lxterminal enable      2>/dev/null || echo "${LXTERMINAL_ENABLE_DEFAULT}")"
    LXTERMINAL_CONFIG_FILE="$(crudini --get ${GCS_CONFIG_FILE} lxterminal config_file 2>/dev/null || echo "${LXTERMINAL_CONFIG_FILE_DEFAULT}")"
}



function check_dependencies() {
    if ! which lxterminal >/dev/null; then
        return 1

    elif ! [ "${LXTERMINAL_ENABLE}" == "true" ]; then
        printf "* Ignoring LXTerminal (disabled from configuration).\n"
        return 1

    elif ! [ -f "${LXTERMINAL_CONFIG_FILE}" ]; then
        printf "* Ignoring LXTerminal (configuration file \"${LXTERMINAL_CONFIG_FILE}\" not found).\n"
        return 1

    else
        return 0

    fi
}



function derive_colors() {
    : ${lxterminal_bg_color:=${terminal_bg_color}}
    : ${lxterminal_fg_color:=${terminal_fg_color}}
}



function create_backup() {
    gcs_backup_file "LXTerminal" "lxterminal" "${LXTERMINAL_CONFIG_FILE}"
}



function restore_backup() {
    gcs_restore_file "LXTerminal" "lxterminal" "${LXTERMINAL_CONFIG_FILE}"
}



function dry_run() {
    printf "* LXTerminal: set text and background colors in \"${LXTERMINAL_CONFIG_FILE}\".\n"
}



function apply_theme() {
    printf "* Setting colors for LXTerminal..."

    local LXTERMINAL_TMP_DIR="${GCS_TMP_DIR}/lxterminal"
    local LXTERMINAL_TMP_CONFIG_FILE="${LXTERMINAL_TMP_DIR}/lxterminal.conf"
    mkdir "${LXTERMINAL_TMP_DIR}"
    cp "${LXTERMINAL_CONFIG_FILE}" "${LXTERMINAL_TMP_CONFIG_FILE}"

    set_value "bgcolor" "=" "${lxterminal_bg_color}" "${LXTERMINAL_TMP_CONFIG_FILE}"
    set_value "fgcolor" "=" "${lxterminal_fg_color}" "${LXTERMINAL_TMP_CONFIG_FILE}"

    mv "${LXTERMINAL_TMP_CONFIG_FILE}" "${LXTERMINAL_CONFIG_FILE}"

    printf " done.\n"
}

