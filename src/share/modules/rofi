#!/bin/bash

function init_module() {
    ROFI_ENABLE_DEFAULT="true"
    ROFI_THEME_FILE_DEFAULT="${HOME}/.config/rofi/themes/gcs-theme.rasi"

    ROFI_ENABLE="$(crudini          --get ${GCS_CONFIG_FILE} rofi enable          2>/dev/null || echo "${ROFI_ENABLE_DEFAULT}")"
    ROFI_THEME_FILE="$(crudini      --get ${GCS_THEME_FILE}  rofi theme_file      2>/dev/null || echo "${ROFI_THEME_FILE_DEFAULT}")"
}



function check_dependencies() {
    if ! which -s rofi; then
        return 1

    elif ! [ "${ROFI_ENABLE}" == "true" ]; then
        printf "* Ignoring rofi (disabled from configuration).\n"
        return 1

    else
        return 0

    fi
}



function derive_colors() {
    : ${rofi_bg_color:=${tray_bg_color}}
    : ${rofi_fg_color:=${tray_fg_color}}
    : ${rofi_base_color:=${base_color}}
    : ${rofi_text_color:=${text_color}}
    : ${rofi_selected_bg_color:=${tray_focused_bg_color}}
    : ${rofi_selected_fg_color:=${tray_focused_fg_color}}
}



function create_backup() {
    gcs_backup_file "rofi" "rofi" "${ROFI_THEME_FILE}"
}



function restore_backup() {
    gcs_restore_file "rofi" "rofi" "${ROFI_THEME_FILE}"
}



function dry_run() {
    printf "* rofi: set colors in \"${ROFI_THEME_FILE}\".\n"
}



function print_module_help() {
    echo "Help for GCS ${BASH_SOURCE##*/} module"
    echo
    echo "This module sets colors for rofi. This is accomplished by setting them in a theme file snippet (${ROFI_THEME_FILE})."
    echo "The user needs to @include this file in its configuration and likely tweak the active theme to use the generated colors"
    echo
    echo "Backup and restore are supported."
    echo
}



function apply_theme() {
    printf "* Setting colors for rofi..."

    local ROFI_THEME_FILE_PATH="${ROFI_THEME_FILE%/*}"
    mkdir -p "${ROFI_THEME_FILE_PATH}"

    echo "/* File auto-generated by GCS. Do not edit */"                                                           > "${ROFI_THEME_FILE}"
    echo "*                {background-color: ${rofi_bg_color}; text-color: ${rofi_fg_color};}"                   >> "${ROFI_THEME_FILE}"
    echo "entry            {background-color: ${rofi_base_color}; text-color: ${rofi_text_color};}"               >> "${ROFI_THEME_FILE}"
    echo "element selected {background-color: ${rofi_selected_bg_color}; text-color: ${rofi_selected_fg_color};}" >> "${ROFI_THEME_FILE}"

    printf " done.\n"
}

