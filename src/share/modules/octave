#!/bin/bash

# FIXME: set_value_section doesn't work, why?

which octave >/dev/null || return

: ${octave_terminal_bg:=${terminal_bg_color}}
: ${octave_terminal_fg:=${terminal_fg_color}}
: ${octave_terminal_selection:=${selected_bg_color}}
: ${octave_terminal_cursor:=${terminal_fg_color}}

: ${octave_current_line_bg:=${editor_current_line_bg}}

: ${octave_workpace_color_a:=${editor_class}}
: ${octave_workpace_color_f:=${editor_number}}
: ${octave_workpace_color_g:=${editor_keyword}}
: ${octave_workpace_color_h:=${editor_operator}}
: ${octave_workpace_color_i:=${editor_string}}
: ${octave_workpace_color_p:=${editor_preprocessor}}

: ${octave_editor_default_fg:=${editor_fg}}
: ${octave_editor_default_bg:=${editor_bg}}
: ${octave_editor_style0_fg:=${editor_fg}}
: ${octave_editor_style0_bg:=${editor_bg}}
: ${octave_editor_style1_fg:=${editor_comment}}
: ${octave_editor_style1_bg:=${editor_bg}}
: ${octave_editor_style2_fg:=${editor_class}}
: ${octave_editor_style2_bg:=${editor_bg}}
: ${octave_editor_style3_fg:=${editor_number}}
: ${octave_editor_style3_bg:=${editor_bg}}
: ${octave_editor_style4_fg:=${editor_keyword}}
: ${octave_editor_style4_bg:=${editor_bg}}
: ${octave_editor_style5_fg:=${editor_number}}
: ${octave_editor_style5_bg:=${editor_bg}}
: ${octave_editor_style6_fg:=${editor_operator}}
: ${octave_editor_style6_bg:=${editor_bg}}
: ${octave_editor_style7_fg:=${editor_fg}}
: ${octave_editor_style7_bg:=${editor_bg}}
: ${octave_editor_style8_fg:=${editor_string}}
: ${octave_editor_style8_bg:=${editor_bg}}

OCTAVE_ENABLE_DEFAULT="true"
OCTAVE_CONFIG_FILE_DEFAULT="$HOME/.config/octave/qt-settings"

OCTAVE_ENABLE="$(crudini      --get ${CONFIG_FILE} octave enable      2>/dev/null || echo "${OCTAVE_ENABLE_DEFAULT}")"
OCTAVE_CONFIG_FILE="$(crudini --get ${CONFIG_FILE} octave config_file 2>/dev/null || echo "${OCTAVE_CONFIG_FILE_DEFAULT}")"

if ! [ "${OCTAVE_ENABLE}" == "true" ]; then
    printf "* Not setting colors for Octave (disabled from configuration).\n"

elif [ "${editor_syntax_enable}" == "false" ]; then
    if [ -f "${OCTAVE_CONFIG_FILE}" ]; then
        crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_b" "${terminal_bg_color}"
        crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_f" "${terminal_fg_color}"
        crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_s" "${selected_bg_color}"
        crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_c" "${terminal_fg_color}"
    fi
    
    # apply defaut colors
    crudini --set "${OCTAVE_CONFIG_FILE}" "editor" "highlight_current_line_color" "#F0F0F0"
    
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_a" "#BEFFFF"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_f" "#DCFFDC"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_g" "#DCDCFF"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_h" "#FFFFBE"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_i" "#FFDCDC"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_p" "#FFBEFF"
    
    set_value "Octave\\\\defaultcolor"    "=" "$(printf "%d" 0x000000)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\defaultpaper"    "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style0\\\\color" "=" "$(printf "%d" 0x000000)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style0\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style1\\\\color" "=" "$(printf "%d" 0x00AA00)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style1\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style2\\\\color" "=" "$(printf "%d" 0x7F7F00)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style2\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style3\\\\color" "=" "$(printf "%d" 0xAAAA00)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style3\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style4\\\\color" "=" "$(printf "%d" 0xF0FFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style4\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style5\\\\color" "=" "$(printf "%d" 0xAAAA00)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style5\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style6\\\\color" "=" "$(printf "%d" 0xDD0000)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style6\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style7\\\\color" "=" "$(printf "%d" 0x000000)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style7\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style8\\\\color" "=" "$(printf "%d" 0xFFAA00)" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style8\\\\paper" "=" "$(printf "%d" 0xFFFFFF)" "${OCTAVE_CONFIG_FILE}"

elif ! [ -f "${OCTAVE_CONFIG_FILE}" ]; then
    printf "* Not setting colors for Octave (configuration \"${OCTAVE_CONFIG_FILE}\" not found).\n"

else
    printf "* Setting colors for Octave..."

    crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_b" "${octave_terminal_bg}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_f" "${octave_terminal_fg}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_s" "${octave_terminal_selection}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "terminal" "color_c" "${octave_terminal_cursor}"

    crudini --set "${OCTAVE_CONFIG_FILE}" "editor" "highlight_current_line_color" "${octave_current_line_bg}"

    # TODO: obseve these in practice
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_a" "${octave_workpace_color_a}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_f" "${octave_workpace_color_f}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_g" "${octave_workpace_color_g}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_h" "${octave_workpace_color_h}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_i" "${octave_workpace_color_i}"
    crudini --set "${OCTAVE_CONFIG_FILE}" "workspaceview" "color_p" "${octave_workpace_color_p}"

    set_value "Octave\\\\defaultcolor"    "=" "$(printf   "%d" 0x${octave_editor_default_fg:1:6})" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\defaultpaper"    "=" "$(printf   "%d" 0x${octave_editor_default_bg:1:6})" "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style0\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style0_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style0\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style0_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style1\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style1_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style1\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style1_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style2\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style2_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style2\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style2_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style3\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style3_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style3\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style3_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style4\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style4_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style4\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style4_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style5\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style5_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style5\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style5_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style6\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style6_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style6\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style6_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style7\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style7_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style7\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style7_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style8\\\\color" "=" "$(printf   "%d" 0x${octave_editor_style8_fg:1:6})"  "${OCTAVE_CONFIG_FILE}"
    set_value "Octave\\\\style8\\\\paper" "=" "$(printf   "%d" 0x${octave_editor_style8_bg:1:6})"  "${OCTAVE_CONFIG_FILE}"

    printf " done.\n"
fi
