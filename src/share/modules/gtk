#!/bin/bash

TMPFILE="/tmp/.oomox-theme"

echo "NAME=gcs-theme" > "${TMPFILE}"
echo "BG=${bg_color:1}" >> "${TMPFILE}"
echo "FG=${text_color:1}" >> "${TMPFILE}"
echo "MENU_BG=${bg_color:1}" >> "${TMPFILE}"
echo "MENU_FG=${text_color:1}" >> "${TMPFILE}"
echo "SEL_BG=${selected_bg_color:1}" >> "${TMPFILE}"
echo "SEL_FG=${selected_fg_color:1}" >> "${TMPFILE}"
echo "TXT_BG=${base_color:1}" >> "${TMPFILE}"
echo "TXT_FG=${text_color:1}" >> "${TMPFILE}"
echo "BTN_BG=${bg_color:1}" >> "${TMPFILE}"
echo "BTN_FG=${text_color:1}" >> "${TMPFILE}"
echo "HDR_BTN_BG=${selected_bg_color:1}" >> "${TMPFILE}"
echo "HDR_BTN_FG=${selected_fg_color:1}" >> "${TMPFILE}"
echo "GTK3_GENERATE_DARK=True" >> "${TMPFILE}"
echo "ROUNDNESS=3" >> "${TMPFILE}"
echo "SPACING=3" >> "${TMPFILE}"
echo "GRADIENT=0.14" >> "${TMPFILE}"

oomox-cli -o gcs-theme "${TMPFILE}" >/dev/null
rm "${TMPFILE}"

# TODO: set parameters in configuration file?
printf "* Setting colors and icon theme for GTK+..."

if ps -e | grep xsettings >/dev/null; then


    set_value "Net\/ThemeName" " " "\"gcs-theme\"" "$HOME/.xsettingsd"
    
    set_value "Net\/IconThemeName" " " "\"${icon_theme_name}\"" "$HOME/.xsettingsd"
    
    killall -SIGHUP xsettingsd
    
    printf " done.\n"
    
elif ps -e | grep gnome-session >/dev/null; then
    
    gtk_theme_name=$(gsettings get org.gnome.desktop.interface gtk-theme)
    
    gsettings set org.gnome.desktop.interface gtk-theme "$gcs-theme"
    
    gsettings set org.gnome.desktop.interface icon-theme "${icon_theme_name}"
    
    printf " done.\n"
    
else
	printf " no supported XSettings manager found!\n"
	# TODO: configure theme/colors with .gtkrc-2.0 and .config/gtk-3.0/settings.ini
fi
